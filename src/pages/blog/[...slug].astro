---
import BaseLayout from "@layouts/BaseLayout.astro";
import SiteNav from "@components/astro/SiteNav.astro";

import { TinaMarkdown } from "tinacms/dist/rich-text";
import components from "@components/react/blog/markdown";
import ExperimentalPostHeader from "@components/react/blog/ExperimentalPostHeader";
import client from "@tina/__generated__/client";
import TagList from "@components/react/blog/TagList";

export async function getStaticPaths() {
  const blogConnection = await client.queries.blogConnection();
  const { edges } = blogConnection.data.blogConnection;
  return edges.map((edge) => {
    return {
      params: {
        slug: edge.node._sys.filename,
      },
      props: {
        relativePath: edge.node._sys.relativePath,
      },
    };
  });
}
const { relativePath } = Astro.props;
const post = await client.queries.blog({ relativePath });

const { title, tags, body: content } = post.data.blog;
---

<BaseLayout {title}>
  <SiteNav />
  <h1>{title}</h1>
  <TagList {tags} />
  <ExperimentalPostHeader client:load {...post} />
  <TinaMarkdown {content} {components} />
</BaseLayout>
